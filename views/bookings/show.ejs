<%- layout("/layouts/boilerplate") %>

<div class="row mt-3">
    <div class="col-8 offset-2">
        <% if(booking.paymentStatus === 'completed') { %>
            <div class="alert alert-success" role="alert">
                <h4 class="alert-heading"><i class="bi bi-check-circle"></i> Booking Confirmed!</h4>
                <p>Your booking has been confirmed and payment received successfully.</p>
            </div>
        <% } else if(booking.paymentStatus === 'pending') { %>
            <div class="alert alert-warning" role="alert">
                <i class="bi bi-exclamation-triangle"></i> Payment is still pending for this booking.
            </div>
        <% } else if(booking.paymentStatus === 'failed') { %>
            <div class="alert alert-danger" role="alert">
                <i class="bi bi-x-circle"></i> Payment failed for this booking. Please contact support.
            </div>
        <% } %>

        <h3>Booking Details</h3>
        <hr />

        <div class="card mb-4">
            <div class="row g-0">
                <div class="col-md-4">
                    <img src="<%= booking.listing.image.url %>" class="img-fluid rounded-start h-100" style="object-fit: cover;" alt="<%= booking.listing.title %>">
                </div>
                <div class="col-md-8">
                    <div class="card-body">
                        <h4 class="card-title"><%= booking.listing.title %></h4>
                        <p class="card-text">
                            <i class="bi bi-geo-alt"></i> <%= booking.listing.location %>, <%= booking.listing.country %>
                        </p>
                        <p class="card-text">
                            <small class="text-muted">Hosted by <%= booking.listing.owner.username %></small>
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">Trip Information</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <h6>Check-in</h6>
                        <p class="text-muted mb-0">
                            <%= new Date(booking.checkIn).toLocaleDateString('en-IN', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' }) %>
                        </p>
                    </div>
                    <div class="col-md-6 mb-3">
                        <h6>Check-out</h6>
                        <p class="text-muted mb-0">
                            <%= new Date(booking.checkOut).toLocaleDateString('en-IN', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' }) %>
                        </p>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <h6>Guests</h6>
                        <p class="text-muted mb-0"><%= booking.guests %> guest<%= booking.guests > 1 ? 's' : '' %></p>
                    </div>
                    <div class="col-md-6 mb-3">
                        <h6>Nights</h6>
                        <p class="text-muted mb-0"><%= booking.getNumberOfNights() %> night<%= booking.getNumberOfNights() > 1 ? 's' : '' %></p>
                    </div>
                </div>
            </div>
        </div>

        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">Payment Information</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <h6>Payment Status</h6>
                        <span class="badge <%= booking.paymentStatus === 'completed' ? 'bg-success' : booking.paymentStatus === 'pending' ? 'bg-warning' : 'bg-danger' %>">
                            <%= booking.paymentStatus.toUpperCase() %>
                        </span>
                    </div>
                    <div class="col-md-6 mb-3">
                        <h6>Total Amount</h6>
                        <p class="text-muted mb-0"><strong>&#8377; <%= booking.totalPrice.toLocaleString("en-IN") %></strong></p>
                    </div>
                </div>
                <% if(booking.razorpayPaymentId) { %>
                    <div class="row">
                        <div class="col-12 mb-3">
                            <h6>Payment ID</h6>
                            <p class="text-muted mb-0"><code><%= booking.razorpayPaymentId %></code></p>
                        </div>
                    </div>
                <% } %>
                <div class="row">
                    <div class="col-12 mb-3">
                        <h6>Booking Date</h6>
                        <p class="text-muted mb-0">
                            <%= new Date(booking.createdAt).toLocaleDateString('en-IN', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' }) %>
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <div class="d-flex gap-2">
            <a href="/bookings" class="btn btn-secondary">
                <i class="bi bi-arrow-left"></i> Back to My Bookings
            </a>
            <a href="/listings/<%= booking.listing._id %>" class="btn btn-outline-primary">
                <i class="bi bi-eye"></i> View Listing
            </a>
        </div>
    </div>
</div>
